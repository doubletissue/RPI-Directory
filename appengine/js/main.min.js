var delay=60,keybind_delay=Math.floor(100+150*Math.random()),padding="15%",last_token=1,cached_results={},local_storage_supported,request;request_in_progress=!1;var suffix_cache=":v2",class_chart_data,department_chart_data,major_chart,department_chart;String.prototype.capitalize=function(){return this.replace(/(^|\s)([a-z])/g,function(a,c,d){return c+d.toUpperCase()})};
function generateMap(a,c){(new google.maps.Geocoder).geocode({address:a},function(d,f){if(f==google.maps.GeocoderStatus.OK){$("#"+c).text("");var b={zoom:16,center:d[0].geometry.location,mapTypeId:google.maps.MapTypeId.ROADMAP},b=new google.maps.Map(document.getElementById(c),b);new google.maps.Marker({map:b,position:d[0].geometry.location})}else f==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?($("#"+c).text("Loading Map..."),setTimeout(function(){generateMap(a,c)},1E3)):console.log("Geocode was not successful for the following reason: "+
f)})}function refreshTable(){$("#results tr:odd").addClass("odd-expand");$("#results tr:not(.odd-expand)").hide();$("#results tr:first-child").show();$("#results tr.odd-expand").click(function(){$(this).next("tr").toggle();$(this).find(".arrow").toggleClass("up");$(this).data("person");$(this).data("number")})}function resetCharts(){class_chart_data.removeRows(0,class_chart_data.getNumberOfRows());department_chart_data.removeRows(0,department_chart_data.getNumberOfRows())}
function redrawCharts(a,c){major_chart.draw(a,{title:"Class/Positions in Results",height:300,animation:{duration:250,easing:"out"}});department_chart.draw(c,{title:"Departments in Results",height:300,animation:{duration:250,easing:"out"}})}
function parseServerData(a){request_in_progress=!1;if(a.data!==[]&&"Quota Exceeded"==a.data)_gaq.push(["_trackEvent","Error","Quota Exceeded"]),jError("You have exceeded our rate limit!  Please wait 5 minutes and try again...",{clickOverlay:!1,MinWidth:250,TimeShown:5E3,LongTrip:20,HorizontalPosition:"center",onClosed:function(){window.location="http://goo.gl/QMET"}});else if(a.data!==[]&&"Error with request, please try again"==a.data)_gaq.push(["_trackEvent","Error","Server Error"]),jError("Our database seems to be having some issues, we apologize.  Lets try refreshing the page to see if that helps.",
{clickOverlay:!1,MinWidth:250,TimeShown:5E3,LongTrip:20,HorizontalPosition:"center",onClosed:function(){location.reload(!0)}});else{0==a.data.length&&$("#results").css("opacity","1");0<a.data.length&&3>Math.abs(last_token-a.token)&&AddResultsToTable(a);var c=a.q+suffix_cache;cached_results[c]=a;if(local_storage_supported)try{localStorage.setItem(c,JSON.stringify(a))}catch(d){d==QUOTA_EXCEEDED_ERR&&localStorage.clear()}}}
function parseCachedData(a){var c=null;cached_results[a]?(c=cached_results[a],console.log("Cached from JS")):local_storage_supported&&localStorage.getItem(a)&&(c=JSON.parse(localStorage.getItem(a)),console.log("Cached from HTML5"));null!==c&&c.data!==[]?AddResultsToTable(c):callServer(a)}
function AddResultsToTable(a){$("#results").find("tbody").empty();resetCharts();if(1>a.data.length)jNotify("No results...try broadening your search?",{clickOverlay:!0,MinWidth:250,TimeShown:1250,LongTrip:20,ShowOverlay:!0,HorizontalPosition:"center",VerticalPosition:"center"});else{var c={},d={};$.each(a.data,function(a,b){var e="<tr id='row"+a+"'>";void 0==b.major&&void 0==b.department?b.major="N/A":void 0!=b.department&&(b.major=b.department);void 0==b.year&&void 0!=b.title?b.year=b.title:void 0==
b.year&&void 0!=b.department&&(b.year="Faculty");var g="";if(void 0!=b.email)for(g=b.email.replace("@"," [at] ");-1<g.indexOf(".");)g=g.replace("."," [dot] ");else g="N/A";e+="<td>"+b.name+"</td><td>"+b.major+"</td><td>"+(void 0==b.year?"N/A":b.year)+"</td><td>"+g+"</td>";e+="</tr><tr><td colspan='4'><h4>Additional information</h4><ul style='float:left'>";for(key in b)"email"!=key&&"rcsid"!=key&&(e+="<li>"+key.capitalize()+": "+b[key]+"</li>");$("#results").find("tbody").append(e+"</ul></td></tr>");
void 0==b.year&&(b.year="N/A");c[b.year]=void 0==c[b.year]?1:c[b.year]+1;d[b.major]=void 0==d[b.major]?1:d[b.major]+1;$("#row"+a).data("person",b);$("#row"+a).data("number",a)});refreshTable();$("#results").css("opacity","1");for(key in c)class_chart_data.addRow([key,c[key]]);for(key in d)department_chart_data.addRow([key,d[key]]);redrawCharts(class_chart_data,department_chart_data)}}
function animate(a){a?($("#qr").hide(),$("#sidebar").show(),$("#container").animate({marginTop:"0%"},delay,function(){$("#container").css("margin-top","0%")})):($("#container").animate({marginTop:padding},1.3*delay),$("#sidebar").hide(),$("#qr").show())}function DetectLocalStorage(){try{if(null!==window.localStorage)return _gaq.push(["_trackEvent","Local Storage","True"]),!0}catch(a){return _gaq.push(["_trackEvent","Local Storage","False"]),!1}}
function callServer(a){request_in_progress&&request.abort();request_in_progress=!0;url="/api?q="+a+"&token="+last_token+"&source=website";request=$.getJSON(url,parseServerData)}
$(document).ready(function(){$("#keyword").focus();$(document).ajaxError(function(a,c,d,f){console.log("Error: "+f);_gaq.push(["_trackEvent","Error","Parsing Error: "+f])});local_storage_supported=DetectLocalStorage();class_chart_data=new google.visualization.DataTable;class_chart_data.addColumn("string","Major");class_chart_data.addColumn("number","Amount");department_chart_data=new google.visualization.DataTable;department_chart_data.addColumn("string","Department");department_chart_data.addColumn("number",
"Amount");major_chart=new google.visualization.PieChart(document.getElementById("major_stats"));department_chart=new google.visualization.PieChart(document.getElementById("department_stats"));$("#keyword").bindWithDelay("keyup",function(){var a=$("#keyword").val().toLowerCase(),c=$("#container").css("margin-top");if(""!=a){last_token+=1;if("0%"!=c||"0px"!=c)animate(!0),_gaq.push(["_trackEvent","Interaction","Moved Box Up"]);$("#results").show();c=a+suffix_cache;cached_results[c]||local_storage_supported&&
localStorage.getItem(c)?(console.log("Pulling from cache"),parseCachedData(c)):($("#results").css("opacity",".25"),callServer(a))}else if(""==a&&($("#results").hide(),"0%"==c||"0px"==c))_gaq.push(["_trackEvent","Interaction","Moved Box Down"]),animate(!1)},keybind_delay)});