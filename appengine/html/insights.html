{% extends "html/base.html" %}
{% block content %}
<div id="container" class="container-fluid">
	<div class="subnav">
	    <ul class="nav nav-pills">
				{% for item in stats %}
	      <li class="{% if loop.first %}active{% endif %}"><a href="#{{item.title.replace(' ', '-')}}">{{item.title}}</a></li>
				{% endfor %}
	    </ul>
	  </div>
	Number of People: {{num_people}} and Number of Stats: {{num_stats}}
	{% for item in stats %}
	{% if loop.index0 is divisibleby 1 %}
  <div class="row-fluid">
	{% endif %}
	<section id="{{item.title.replace(' ', '-')}}">
    <div class="span12" style="height: {{chart_height}}px">
      <div id="chart_{{loop.index}}"></div>
    </div>
	</section>
	{% if loop.index is divisibleby 1 %}
  </div>
	{% endif %}
	{% endfor %}
</div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">

      // Load the Visualization API and the piechart package.
      google.load('visualization', '1.0', {'packages':['corechart']});

      // Set a callback to run when the Google Visualization API is loaded.
      google.setOnLoadCallback(drawCharts);

      // Callback that creates and populates a data table,
      // instantiates the pie chart, passes in the data and
      // draws it.
      function drawCharts() {
      // Create the data table.
			{% for item in stats %}
        var data_{{loop.index}} = new google.visualization.DataTable();
        data_{{loop.index}}.addColumn('string', 'Category');
        data_{{loop.index}}.addColumn('number', 'Amount');
        data_{{loop.index}}.addRows([
					{% for data_point, amount in item.data|dictsort(false, 'value') %}
					{% if amount > 3 %}["{{data_point.title()}}", {{amount}}],{% endif %}
					{% endfor %}
        ]);

        // Set chart options
        var options_{{loop.index}} = {'title': '{{item.title}}', 
																			'height': {{chart_height}}, 
																			'pieSliceText': 'value',
																		  'tooltip' : {'text': 'value'},
																		  'reverseCategories': true,
																			'legend': {'position': 'none'}};

        // Instantiate and draw our chart, passing in some options.
        var chart_{{loop.index}} = new google.visualization.ColumnChart(document.getElementById('chart_{{loop.index}}'));
        chart_{{loop.index}}.draw(data_{{loop.index}}, options_{{loop.index}});
			{% endfor %}
      }
    </script>
<script type="text/javascript">
$(document).ready(function() {
	$('.subnav').scrollspy();
});
$(document).scroll(function(){
    // If has not activated (has no attribute "data-top"
    if (!$('.subnav').attr('data-top')) {
        // If already fixed, then do nothing
        if ($('.subnav').hasClass('subnav-fixed')) return;
        // Remember top position
        var offset = $('.subnav').offset();
        $('.subnav').attr('data-top', offset.top);
    }

    if ($('.subnav').attr('data-top') - $('.subnav').outerHeight() <= $(this).scrollTop())
        $('.subnav').addClass('subnav-fixed');
    else
        $('.subnav').removeClass('subnav-fixed');
});
</script>
{% endblock %}